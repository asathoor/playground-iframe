<?php
 declare( strict_types = 1 ); final class WP_Ability_Categories_Registry { private static $instance = null; private $registered_categories = array(); public function register( string $slug, array $args ): ?WP_Ability_Category { if ( $this->is_registered( $slug ) ) { _doing_it_wrong( __METHOD__, sprintf( __( 'Ability category "%s" is already registered.' ), esc_html( $slug ) ), '6.9.0' ); return null; } if ( ! preg_match( '/^[a-z0-9]+(?:-[a-z0-9]+)*$/', $slug ) ) { _doing_it_wrong( __METHOD__, __( 'Ability category slug must contain only lowercase alphanumeric characters and dashes.' ), '6.9.0' ); return null; } $args = apply_filters( 'wp_register_ability_category_args', $args, $slug ); try { $category = new WP_Ability_Category( $slug, $args ); } catch ( InvalidArgumentException $e ) { _doing_it_wrong( __METHOD__, $e->getMessage(), '6.9.0' ); return null; } $this->registered_categories[ $slug ] = $category; return $category; } public function unregister( string $slug ): ?WP_Ability_Category { if ( ! $this->is_registered( $slug ) ) { _doing_it_wrong( __METHOD__, sprintf( __( 'Ability category "%s" not found.' ), esc_html( $slug ) ), '6.9.0' ); return null; } $unregistered_category = $this->registered_categories[ $slug ]; unset( $this->registered_categories[ $slug ] ); return $unregistered_category; } public function get_all_registered(): array { return $this->registered_categories; } public function is_registered( string $slug ): bool { return isset( $this->registered_categories[ $slug ] ); } public function get_registered( string $slug ): ?WP_Ability_Category { if ( ! $this->is_registered( $slug ) ) { _doing_it_wrong( __METHOD__, sprintf( __( 'Ability category "%s" not found.' ), esc_html( $slug ) ), '6.9.0' ); return null; } return $this->registered_categories[ $slug ]; } public static function get_instance(): ?self { if ( ! did_action( 'init' ) ) { _doing_it_wrong( __METHOD__, sprintf( __( 'Ability API should not be initialized before the %s action has fired.' ), '<code>init</code>' ), '6.9.0' ); return null; } if ( null === self::$instance ) { self::$instance = new self(); do_action( 'wp_abilities_api_categories_init', self::$instance ); } return self::$instance; } public function __wakeup(): void { throw new LogicException( __CLASS__ . ' should never be unserialized.' ); } public function __sleep(): array { throw new LogicException( __CLASS__ . ' should never be serialized.' ); } } 