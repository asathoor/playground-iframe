<?php
 function render_block_core_file( $attributes, $content ) { if ( empty( $attributes['displayPreview'] ) ) { return $content; } wp_enqueue_script_module( '@wordpress/block-library/file/view' ); $processor = new WP_HTML_Tag_Processor( $content ); if ( $processor->next_tag() ) { $processor->set_attribute( 'data-wp-interactive', 'core/file' ); } if ( ! $processor->next_tag( 'OBJECT' ) ) { return $content; } $processor->set_attribute( 'data-wp-bind--hidden', '!state.hasPdfPreview' ); $processor->set_attribute( 'hidden', true ); $filename = $processor->get_attribute( 'aria-label' ); $has_filename = is_string( $filename ) && ! empty( $filename ) && 'PDF embed' !== $filename; $label = $has_filename ? sprintf( __( 'Embed of %s.' ), $filename ) : __( 'PDF embed' ); $processor->set_attribute( 'aria-label', $label ); return $processor->get_updated_html(); } function register_block_core_file() { register_block_type_from_metadata( __DIR__ . '/file', array( 'render_callback' => 'render_block_core_file', ) ); } add_action( 'init', 'register_block_core_file' ); 