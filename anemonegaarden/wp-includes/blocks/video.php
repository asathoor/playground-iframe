<?php
 function render_block_core_video( array $attributes, string $content ): string { if ( ! str_contains( $content, '<video' ) ) { return $content; } if ( ! isset( $attributes['id'] ) || ! is_int( $attributes['id'] ) || $attributes['id'] <= 0 ) { return $content; } if ( get_post_type( $attributes['id'] ) !== 'attachment' ) { return $content; } $metadata = wp_get_attachment_metadata( $attributes['id'] ); if ( ! isset( $metadata['width'], $metadata['height'] ) || ! ( is_int( $metadata['width'] ) && is_int( $metadata['height'] ) ) || ! ( $metadata['width'] > 0 && $metadata['height'] > 0 ) ) { return $content; } $p = new WP_HTML_Tag_Processor( $content ); if ( ! $p->next_tag( array( 'tag_name' => 'VIDEO' ) ) ) { return $content; } $p->set_attribute( 'width', (string) $metadata['width'] ); $p->set_attribute( 'height', (string) $metadata['height'] ); $style = $p->get_attribute( 'style' ); if ( ! is_string( $style ) ) { $style = ''; } $aspect_ratio_style = sprintf( 'aspect-ratio: %d / %d;', $metadata['width'], $metadata['height'] ); $p->set_attribute( 'style', $aspect_ratio_style . $style ); return $p->get_updated_html(); } function register_block_core_video(): void { register_block_type_from_metadata( __DIR__ . '/video', array( 'render_callback' => 'render_block_core_video', ) ); } add_action( 'init', 'register_block_core_video' ); 