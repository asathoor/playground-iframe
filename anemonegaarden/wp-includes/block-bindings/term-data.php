<?php
 function _block_bindings_term_data_get_value( array $source_args, $block_instance ) { if ( empty( $source_args['field'] ) ) { return null; } $block_name = $block_instance->name ?? ''; $is_navigation_block = in_array( $block_name, array( 'core/navigation-link', 'core/navigation-submenu' ), true ); if ( $is_navigation_block ) { $term_id = $block_instance->attributes['id'] ?? null; $type = $block_instance->attributes['type'] ?? ''; $taxonomy = ( 'tag' === $type ) ? 'post_tag' : $type; } else { $term_id = $block_instance->context['termId'] ?? null; $taxonomy = $block_instance->context['taxonomy'] ?? ''; } if ( empty( $term_id ) || empty( $taxonomy ) ) { return null; } $term = get_term( $term_id, $taxonomy ); if ( is_wp_error( $term ) || ! $term ) { return null; } $taxonomy_object = get_taxonomy( $taxonomy ); if ( ! $taxonomy_object || ! $taxonomy_object->publicly_queryable ) { if ( ! current_user_can( 'read' ) ) { return null; } } switch ( $source_args['field'] ) { case 'id': return esc_html( (string) $term_id ); case 'name': return esc_html( $term->name ); case 'link': $term_link = get_term_link( $term ); return is_wp_error( $term_link ) ? null : esc_url( $term_link ); case 'slug': return esc_html( $term->slug ); case 'description': return wp_kses_post( $term->description ); case 'parent': return esc_html( (string) $term->parent ); case 'count': return esc_html( (string) $term->count ); default: return null; } } function _register_block_bindings_term_data_source() { if ( get_block_bindings_source( 'core/term-data' ) ) { return; } register_block_bindings_source( 'core/term-data', array( 'label' => _x( 'Term Data', 'block bindings source' ), 'get_value_callback' => '_block_bindings_term_data_get_value', 'uses_context' => array( 'termId', 'taxonomy' ), ) ); } add_action( 'init', '_register_block_bindings_term_data_source' ); 