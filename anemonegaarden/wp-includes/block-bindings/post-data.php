<?php
 function _block_bindings_post_data_get_value( array $source_args, $block_instance ) { if ( empty( $source_args['field'] ) ) { if ( empty( $source_args['key'] ) ) { return null; } $field = $source_args['key']; } else { $field = $source_args['field']; } $block_name = $block_instance->name ?? ''; $is_navigation_block = in_array( $block_name, array( 'core/navigation-link', 'core/navigation-submenu' ), true ); if ( $is_navigation_block ) { $post_id = $block_instance->attributes['id'] ?? null; } else { $post_id = $block_instance->context['postId'] ?? null; } if ( empty( $post_id ) ) { return null; } $post = get_post( $post_id ); if ( ( ! is_post_publicly_viewable( $post ) && ! current_user_can( 'read_post', $post_id ) ) || post_password_required( $post ) ) { return null; } if ( 'date' === $field ) { return esc_attr( get_the_date( 'c', $post_id ) ); } if ( 'modified' === $field ) { if ( get_the_modified_date( 'U', $post_id ) > get_the_date( 'U', $post_id ) ) { return esc_attr( get_the_modified_date( 'c', $post_id ) ); } else { return ''; } } if ( 'link' === $field ) { $permalink = get_permalink( $post_id ); return false === $permalink ? null : esc_url( $permalink ); } } function _register_block_bindings_post_data_source() { register_block_bindings_source( 'core/post-data', array( 'label' => _x( 'Post Data', 'block bindings source' ), 'get_value_callback' => '_block_bindings_post_data_get_value', 'uses_context' => array( 'postId', 'postType' ), ) ); } add_action( 'init', '_register_block_bindings_post_data_source' ); 